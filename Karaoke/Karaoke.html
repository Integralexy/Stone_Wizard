<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Karaoke Night</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f9fc;
    max-width: 700px;
    margin: 40px auto;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  .question { display: none; margin-bottom: 20px; }
  .question.active { display: block; }
  .response {
    background: #eaf4e1;
    border-left: 5px solid #4CAF50;
    padding: 10px;
    margin-top: 10px;
    display: none;
  }
  button {
    margin-top: 10px;
    background-color: #007bff;
    color: white;
    padding: 10px 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover { background-color: #0056b3; }
</style>
</head>
<body>

<h1 style="text-align:center;">You, Me, Karaoke</h1>
<h2 style="text-align:center;">Who can make the crowd cry for all the wrong reasons?</h2>

  <!-- Start Screen -->
<div id="startScreen" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:300px; text-align:center;">
  <h2>Take the quiz to find out where we should go:</h2>
  <button type="button" onclick="startQuiz()" style="padding: 12px 20px; font-size: 16px;">Start</button>
</div>
  
<form id="quizForm">

  <!-- Question 1 -->
  <div class="question" data-question="1">
    <p>Which area will you be leaving from?</p>
    <label><input type="radio" name="q1" value="U"> Udistrict</label><br>
    <label><input type="radio" name="q1" value="F"> Fremont</label><br>
    <label><input type="radio" name="q1" value="C"> Cap Hill</label><br>
    <label><input type="radio" name="q1" value="H"> Heaven ðŸ˜‰</label><br>
    <button type="button" onclick="submitAnswer(1)">Submit Answer</button>
    <div class="response" id="response1"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next1">Continue</button>
  </div>

  <!-- Question 2 -->
  <div class="question" data-question="2">
    <p>What vibes are you looking for?</p>
    <label><input type="radio" name="q2" value="Monk"> "Dive bar with carpet"</label><br>
    <label><input type="radio" name="q2" value="Rock"> "Chill Cocktail bar with snacks"</label><br>
    <label><input type="radio" name="q2" value="Finn"> "Sports bar with a hint of Celtic vibes"</label><br>
    <label><input type="radio" name="q2" value="Hula"> "I've always wanted to go to a Luau"</label><br>
    <label><input type="radio" name="q2" value="Fruit"> "Something a little fruity"</label><br>
    <button type="button" onclick="submitAnswer(2)">Submit Answer</button>
    <div class="response" id="response2"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next2">Continue</button>
  </div>

  <!-- Question 3 -->
  <div class="question" data-question="3">
    <p>Do you prefer singing in front of an audience or just among friends?</p>
    <label><input type="radio" name="q3" value="star"> "I am the star"</label><br>
    <label><input type="radio" name="q3" value="shy"> "I'm a bit shy"</label><br>
    <label><input type="radio" name="q3" value="none"> "I like having both as an option"</label><br>
    <button type="button" onclick="submitAnswer(3)">Submit Answer</button>
    <div class="response" id="response3"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next3">Continue</button>
  </div>

  <!-- Question 4 -->
  <div class="question" data-question="4">
    <p>Before you get five drinks in, what's your first order?</p>
    <label><input type="radio" name="q4" value="beer"> A beer</label><br>
    <label><input type="radio" name="q4" value="cider"> A cider</label><br>
    <label><input type="radio" name="q4" value="Cock"> A Cocktail </label><br>
    <label><input type="radio" name="q4" value="shot"> A shot</label><br>
    <button type="button" onclick="submitAnswer(4)">Submit Answer</button>
    <div class="response" id="response4"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next4">Continue</button>
  </div>

  <!-- Sub-questions -->
  <div class="question" data-question="4a">
    <p>What kind of beer?</p>
    <label><input type="radio" name="q4a" value="IPA"> An IPA</label><br>
    <label><input type="radio" name="q4a" value="dark"> Something dark</label><br>
    <label><input type="radio" name="q4a" value="cheap"> The cheaper the better</label><br>
    <button type="button" onclick="submitAnswer('4a')">Submit Answer</button>
    <div class="response" id="response4a"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next4a">Continue</button>
  </div>

  <div class="question" data-question="4b">
    <p>What kind of Cocktail?</p>
    <label><input type="radio" name="q4b" value="marg"> Margarita </label><br>
    <label><input type="radio" name="q4b" value="cos"> Cosmo </label><br>
    <label><input type="radio" name="q4b" value="mar"> Martini </label><br>
    <button type="button" onclick="submitAnswer('4b')">Submit Answer</button>
    <div class="response" id="response4b"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next4b">Continue</button>
  </div>

  <div class="question" data-question="4c">
    <p>What kind of shot?</p>
    <label><input type="radio" name="q4c" value="vod"> Vodka </label><br>
    <label><input type="radio" name="q4c" value="teq"> Tequila </label><br>
    <label><input type="radio" name="q4c" value="whis"> Whiskey </label><br>
    <button type="button" onclick="submitAnswer('4c')">Submit Answer</button>
    <div class="response" id="response4c"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next4c">Continue</button>
  </div>

  <!-- Question 5 -->
  <div class="question" data-question="5">
    <p>What do you like about Andrew?</p>
    <label><input type="radio" name="q5" value="N" onchange="checkEligibility(5)"> "A little weird"</label><br>
    <label><input type="radio" name="q5" value="Y" onchange="checkEligibility(5)"> "Cute and Funny"</label><br>
    <label><input type="radio" name="q5" value="N" onchange="checkEligibility(5)"> "He could use a haircut"</label><br>
    <label><input type="radio" name="q5" value="N" onchange="checkEligibility(5)"> "I only want to meet his dogs"</label><br>
    <button type="button" id="submit5" onclick="submitAnswer(5)" disabled>Submit Answer</button>
    <div class="response" id="response5"></div>
    <button type="button" onclick="nextQuestion()" style="display:none;" id="next5">Continue</button>
  </div>

</form>

<div id="finalResult" style="display:none;background:#e2f0d9;padding:15px;border-radius:8px;margin-top:20px;">
  <h3>Thank you for completing the questionnaire! According to your answers, you might want to check out: </h3>
</div>

<script>
let currentQuestion = 1;  // declare first

function startQuiz() {
  document.getElementById("startScreen").style.display = "none";
  currentQuestion = 1;
  const firstQ = document.querySelector(`[data-question="${currentQuestion}"]`);
  if (firstQ) firstQ.classList.add("active");
}
  

const answers = {};
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxmO2ih5aR9x8W_Y3Ejfk0M44PVNoxWD29avZdZbveCTjHTjuaRkvKU8oD0FZ3lul0q/exec";

const responses = {
  1: {U:"You must study hard! ðŸ‘©â€ðŸ«", F:"Its giving artsy! ðŸ‘©â€ðŸŽ¨", C:"You definitely know how to party! ðŸ¥³", H:"I had a feeling, but didn't want to assume ðŸ˜"},
  2: {Monk:"Then you can beat me in a game of pool afterwards ðŸŽ±", Finn:"Hopefully you like Guinness â˜˜ï¸", Rock:"I too like to feel fancy ðŸ¸", Hula:"I'll need an umbrella in my drink ðŸ¹", Fruit:"Good thing we're in Seattle ðŸ™ï¸"},
  3: {star:"I commend your bravery ðŸ«¡", shy:"Same, I'm just a lil guy ðŸ¥ºðŸ‘‰ðŸ‘ˆ", none:"No problem! I'll embarrass myself either way ðŸ—£ï¸"},
  4: {beer:"", cider:"Is this how you got so sweet? ðŸ˜œ", Cock:"", shot:""},
  "4a": {IPA:"Are we talking beer or the International Phonetic Alphabet? ðŸ”¤", dark:"First round is definitely on me ðŸ»", cheap:"Ah, a connoisseur of the financially efficient lager ðŸº"},
  "4b": {marg:"So you like hispanic flavors ðŸ‡²ðŸ‡½ðŸ˜", cos:"So something as vibrant as your smile? ðŸ˜", mar:"Shaken or stirred? ðŸ•µï¸â€â™‚ï¸"},
  "4c": {vod:"I too like to live dangerously âš ï¸", teq:"Just so you know, tequila makes me want to dance ðŸ•º", whis:"Whiskey on the rocks? I might start melting ðŸ¥ƒ"},
  5: {N:"Invalid selection, please try again ", Y:"Staaawwppp ðŸ«£ðŸ˜"}
};

function submitAnswer(qNum) {
  const qDiv = document.querySelector(`[data-question="${qNum}"]`);
  const inputs = qDiv.querySelectorAll('input');
  let value = null;
  inputs.forEach(i => { if (i.checked) value = i.value; });
  if (!value) { alert("Please select an answer first!"); return; }

  answers["q" + qNum] = value;

  // Show response
  const rDiv = document.getElementById("response" + qNum);
  rDiv.textContent = responses[qNum][value] || "Interesting choice!";
  rDiv.style.display = "block";

  // Show continue button
  const nextBtn = document.getElementById("next" + qNum);
  if (nextBtn) nextBtn.style.display = "inline-block";

  // Enable submit button for Q5 if eligible
  if (qNum === 5) {
  if (value === "Y") {
    nextBtn.style.display = "inline-block"; // show continue
  } else {
    nextBtn.style.display = "none"; // hide continue
  }
} else if (nextBtn) {
  nextBtn.style.display = "inline-block"; // normal behavior for other questions
}
  }

  // Send data to Google Script
  fetch(SCRIPT_URL, {
    method:"POST",
    mode:"no-cors",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({question:"Question "+qNum, answer:value, response:rDiv.textContent})
  });
}

function nextQuestion() {
  const current = document.querySelector(".question.active");
  if (current) current.classList.remove("active");

  // Determine next question
  if (currentQuestion === 4) {
    // Q4 flow â†’ sub-questions or skip to 5 for cider
    if (answers.q4 === "beer") currentQuestion = "4a";
    else if (answers.q4 === "Cock") currentQuestion = "4b";
    else if (answers.q4 === "shot") currentQuestion = "4c";
    else if (answers.q4 === "cider") currentQuestion = 5;
  } 
  else if (["4a","4b","4c"].includes(currentQuestion)) {
    currentQuestion = 5; // After sub-question, go to Q5
  } 
  else if (currentQuestion === 5) {
    finishQuiz();
    return;
  } 
  else {
    currentQuestion++;
  }

  const next = document.querySelector(`[data-question="${currentQuestion}"]`);
  if (next) next.classList.add("active");
  else finishQuiz();
}

function checkEligibility(qNum) {
  const radios = document.getElementsByName(`q${qNum}`);
  let val = "";
  for (let r of radios) if (r.checked) val = r.value;
  document.getElementById(`submit${qNum}`).disabled = (val !== "Y");
}
// Initialize score trackers
let scores = { M: 0, R: 0, F: 0, H: 0, C: 0 };

// Define how each main question answer affects scores
const scoreRules = {
  q2: { // vibes
    Monk: ["M"],
    Rock: ["R"],
    Finn: ["F"],
    Hula: ["H"],
    Fruit: ["C"]
  },
  q3: { // audience preference
    star: ["M", "R", "F", "H", "C"],
    shy: ["R"],
    none: ["M", "R", "F", "H", "C"]
  },
  q4: { // first drink
    beer: ["M", "F"],
    cider: ["M", "F"],
    Cock: ["R", "C"],
    shot: ["M", "R", "F", "H", "C"]
  }
};

// Function to calculate scores based on main questions
function calculateScores() {
  // Reset scores
  scores = { M: 0, R: 0, F: 0, H: 0, C: 0 };

  for (const q of ["q2", "q3", "q4"]) {
    const val = answers[q];
    if (val && scoreRules[q][val]) {
      scoreRules[q][val].forEach(track => {
        scores[track]++;
      });
    }
  }

  console.log("Scores from Q2, Q3, Q4:", scores);
  return scores;
}

// Call this in your finishQuiz function
function finishQuiz() {
  document.getElementById("quizForm").style.display = "none";
  document.getElementById("finalResult").style.display = "block";

  const finalScores = calculateScores();

  // Map variables to real venue names
  const venueNames = {
    M: "Monkey Pub",
    R: "Rock Box",
    F: "Finn Maccools",
    H: "Hula Hula",
    C: "Crescent Lounge"
  };

  // Find max score
  const maxScore = Math.max(...Object.values(finalScores));

  // Separate winners and others
  const winners = [];
  const others = [];
  for (const track in finalScores) {
    if (finalScores[track] === maxScore) winners.push(track);
    else others.push(track);
  }

  // Construct display text
  let resultText = "";

  if (winners.length === 1) {
    resultText += `Your top match is ${venueNames[winners[0]]} with a score of ${finalScores[winners[0]]}!\n\n`;
  } else {
    resultText += `You have a tie between: ${winners.map(w => venueNames[w]).join(", ")}\n`;
    winners.forEach(w => {
      resultText += `${venueNames[w]}: ${finalScores[w]}\n`;
    });
    resultText += "\n";
  }

  if (others.length) {
    resultText += "See also:\n";
    others.forEach(o => {
      resultText += `${venueNames[o]}: ${finalScores[o]}\n`;
    });
  }

  document.getElementById("finalResult").innerText = resultText;

  console.log("All answers:", answers);
  console.log("Final Scores:", finalScores);
}
</script>

</body>
</html>
